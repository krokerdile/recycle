# QUESTION DEVELOP

---
## 질문 글 생성

### 설계
1. 클라이언트에서 content를 받는다.
2. 토큰의 정보를 통해 얻은 작성자의 정보와 작성일자와 같은 정보들을 조합한다.
3. 조합한 정보를 DB에 저장한다.
4. 저장한 정보를 이벤트로 날려 질문 글 생성 이벤트를 발행한다.
5. 질문 글 생성 이벤트를 review-query 서버에서 받아 질문 글을 생성한다.

### 예외
| 번호 | 처리 |
|----|---|
| 1 | 토큰에 담긴 유저에 대한 정보가 없을경우 |

### 쿼리
| 번호 | 쿼리                                                                                                                  |
|----|---------------------------------------------------------------------------------------------------------------------|
| 1 | `question_id`, `content`, `author`, `author_id`, `review_cnt`, `created_at`, `updated_at` 값을 review 서버에 저장한다.       |
| 2 | `question_id`, `content`, `author`, `author_id`, `review_cnt`, `created_at`, `updated_at` 값을 review-query 서버에 저장한다. |
---
## 질문 글 임시 저장

### 설계
1. 클라이언트에서 t_id와 content를 받는다.
2. 토큰의 정보를 통해 얻은 작성자의 정보와 작성일자와 같은 정보들을 조합한다.
3. t_id와 질문 글을 뜻하는 question, 멤버의 이름을 합쳐 key로 설정하여 redis에 저장한다.

### 예외
| 번호 | 처리 |
|----|---|
| 1 | 토큰에 담긴 유저에 대한 정보가 없을경우 |

### 쿼리
| 번호 | 쿼리                                                                                                 |
|----|----------------------------------------------------------------------------------------------------|
| 1 | `t_id`, `content`, `author`, `author_id`, `review_cnt`, `created_at`, `updated_at` 값을 redis에 저장한다. |
---
## 질문 글 조회

### 설계
1. 클라이언트에서 question_id를 받는다.
2. question_id를 통해 DB에서 질문 글을 조회한다.
3. 조회한 질문 글을 클라이언트에게 전달한다.

### 예외
| 번호 | 처리 |
|----|---|
| 1 | question_id에 해당하는 질문 글이 없을 경우 |

### 쿼리
| 번호 | 쿼리                            |
|----|-------------------------------|
| 1 | `question_id`를 통해 질문 글을 검색한다. |
---
## 멤버 기준 질문 글 목록 조회

### 설계
1. 클라이언트에서 page와 size를 받는다.
2. 토큰의 정보를 통해 얻은 멤버의 정보를 통해 멤버가 작성한 질문 글 목록을 조회한다.
3. 조회한 멤버의 질문 글 목록을 클라이언트에게 전달한다.
   - 만약 정보가 없을 경우 빈 배열을 전달한다.

### 예외 
| 번호 | 처리 |
|----|---|
| 1 | 토큰에 담긴 유저에 대한 정보가 없을경우 |

### 쿼리
| 번호 | 쿼리                              |
|----|---------------------------------|
| 1 | `author_id` 를 통해 질문 글 목록을 조회한다. |
---
## 멤버의 임시 질문 글 목록 조회, 멤버의 임시 질문 글 조회

### 설계
1. 클라이언트에서 t_id와 page와 size를 받는다.
    - `t_id`가 있다면 임시 질문 글 하나, 없다면 해당 멤버가 작성한 임시 질문 글 목록을 조회하기 위해 분기한다.
2. 토큰의 정보를 통해 얻은 멤버의 정보와 t_id, 질문임을 알기 위한 question을 조합하여 key를 만들어 조회한다.
   - `t_id`가 없을 경우에는 제외하고 키 생성
   - ex) `question_authorId_tId`, `question_authorId`
3. 조회한 멤버의 임시 질문 글 목록을 클라이언트에게 전달한다.
   - 만약 정보가 없을 경우 빈 배열을 전달한다.

### 예외
| 번호 | 처리 |
|----|---|
| 1 | 토큰에 담긴 유저에 대한 정보가 없을경우 |

### 쿼리  
| 번호 | 쿼리                                                                                       |
|----|------------------------------------------------------------------------------------------|
| 1 | redis DB에 like 검색을 사용하여 키값( ex) `question_authorId_tId` )을 통해  멤버가 작성한 임시 질문 글 목록을 조회한다. |
---
## 멤버 기준 질문 글 목록에서 ‘검색어’를 포함한 내용을 가진 글 리스트 조회

### 설계  
1. 클라이언트에서 page, size, query를 받는다.
2. 토큰의 정보를 통해 얻은 멤버의 정보와 query를 기준으로 멤버가 작성한 질문 글 목록을 조회한다.
3. 조회한 멤버의 질문 글 목록을 클라이언트에게 전달한다.
   - 만약 정보가 없을 경우 빈 배열을 전달한다.

### 예외
| 번호 | 처리 |
|----|---|
| 1 | 토큰에 담긴 유저에 대한 정보가 없을경우 |

### 쿼리
| 번호 | 쿼리                                      |
|----|-----------------------------------------|
| 1 | `query` 를 검색어로 내용이 포함 된 멤버의 질문 글을 조회한다. |

---
## 질문 글 삭제

### 설계
1. 클라이언트에서 question_id를 받는다.
2. question_id를 통해 DB에서 질문 글을 조회한다.
3. 조회한 질문 글의 작성자와 토큰의 정보를 통해 얻은 작성자의 정보를 비교한다.
4. 작성자가 맞다면 질문 글을 question_id를 통해 DB에서 질문 글을 삭제한다.
3. 질문 글이 삭제되었음을 이벤트로 날려 질문 글 삭제 이벤트를 발행한다.
4. 질문 글 삭제 이벤트를 review-query 서버에서 받아 질문 글을 삭제한다.

### 예외
| 번호 | 처리                            |
|----|-------------------------------|
| 1 | question_id에 해당하는 질문 글이 없을 경우 |
| 2 | 토큰에 담긴 유저에 대한 정보가 없을 경우       |
| 3 | 작성자가 아닐 경우                     |

### 쿼리
| 번호 | 쿼리                                               |
|----|--------------------------------------------------|
| 1  | `question_id` 를 통해 질문 글을 조회한다.                   |
| 2  | `question_id` 를 통해 review 서버에서 질문 글을 삭제한다.       |
 | 3  | `question_id` 를 통해 review-query 서버에서 질문 글을 삭제한다. |

---
## 질문 글에 리뷰를 단 리뷰어 목록

### 설계
1. 질문 글에 리뷰를 달 때 해당 리뷰어의 정보를 저장한다.
2. 클라이언트에서 question_id를 받는다.
3. 해당 질문 글이 있는지 검사한다.
4. 목록 요청 시 해당 질문 글에 단 리뷰어의 목록을 조회한다.
5. 조회한 리뷰어 목록을 클라이언트에게 전달한다.
   - 만약 정보가 없을 경우 빈 배열을 전달한다.

### 예외
| 번호 | 처리 |
|----|---|
| 1 | 해당 질문이 존재하지 않는 경우 |

### 쿼리
| 번호 | 쿼리                                 |
|----|------------------------------------|
| 1 | `question_id` 를 통해 질문 글이 있는지 검사한다. |
| 2 | `question_id` 를 통해 리뷰어 목록을 조회한다.   |