# Question ARCHITECTURE

```
---------          -------------  
          | ---> | Review Server | ---> db (MySQL)
  Clinet  |        ------------- 
          |        -------------  
          |       | Event Queue |  
          |        ------------- 
          |        --------------------- 
          | <---  | Review Query Server  | <--- db (Elasticsearch)
---------          --------------------- 
```          
## CRUD
### CQRS 패턴
기본적인 CRUD 기능에서 성능의 향상을 도모하기 위해 CQRS 패턴을 적용하였습니다. </br>
CQRS패턴은 Command와 Query를 분리하여 Command에서는 데이터의 변경을, Query에서는 데이터의 조회를 담당하는 패턴입니다. </br>
이를 통해 데이터의 변경과 조회를 별도의 서비스로 분리함으로써 서비스의 확장성을 높이고, 성능을 향상시킬 수 있습니다. </br>

이번 프로젝트에서는 이벤트 소싱을 기반으로한 CQRS패턴을 적용합니다. </br>
클라이언트에서 Command에 해당하는 Create, Update, Delete 요청을 받으면, 해당 요청을 db에 저장하고 이벤트로 발행합니다. </br>
발행 된 이벤트는 rabbit MQ를 통해 큐로 저장되며, 해당 큐를 Review Query서버에서 구독합니다. </br>
이벤트를 발행한 후 Query서버에서는 이벤트를 수신하여 db에 저장합니다. </br>
이후 클라이언트에서 Query에 해당하는 Read 요청을 받으면, Review Query서버는 db에서 데이터를 조회하여 반환합니다. </br>
이렇게 함으로써 Command와 Query의 책임을 분리하여 CQRS패턴을 적용해 볼 예정입니다.

## 임시저장
### redis
이번 프로젝트에서는 임시저장 기능을 필요로 합니다. </br>
이를 위해 redis를 사용하여 임시저장 기능을 구현합니다. </br>

redis를 사용하는 이유는 다음과 같습니다. </br>

**Seq1. 임시 저장된 데이터를 불러온 후 저장**
```
    기존의 임시 저장 데이터
   ------------------->
                      | 데이터 로드
                      v    수정된 임시 저장 데이터
                     ---------------------------> // 캐시 삭제
                                                | 질문 글 / 리뷰 등록
                                                v     
```
임시 저장은 데이터를 임시적으로 보관하고, 최종적으로 질문 글, 리뷰를 등록하는 임시 보관소의 역할을 합니다. 
따라서, DB는 아니되 로컬도 아닌 중간 느낌의 저장소를 필요로 했습니다.</br>

**Seq2. 임시 저장된 데이터의 재저장 불가능**
```
    기존의 임시 저장 데이터
   ------------------->
                      | 데이터 로드
                      v    수정된 임시 저장 데이터
                     ---------------------------> // 캐시 삭제
                                                --------X------->  
```
임시 저장은 불러온 데이터의 재저장을 허용하지 않습니다. 따라서 잦은 생성과 삭제가 발생할 것으로 예상됩니다.
이를 위해, 임시 저장 데이터를 저장하는 저장소는 캐시가 적합하다고 판단했습니다.</br>

**Seq3. 임시 저장된 데이터의 유효기간**
```
                     임시 저장 데이터             TTL Over
   -------------------------------------------->// 캐시 삭제
```
임시 저장 데이터는 유효기간이 존재합니다. 따라서, 유효기간이 지난 데이터는 삭제되어야 합니다.
redis를 통해 TTL을 데이터에 걸어 유효기간이 지난 데이터는 자동으로 삭제되도록 하기 위하여 캐시를 선택하였습니다.</br>